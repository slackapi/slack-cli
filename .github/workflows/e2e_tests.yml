name: Manual Trigger E2E tests in CircleCI

# configure manual trigger
on:
  workflow_dispatch:
    inputs:
      branch:
        description: "The branch to build"
        required: true
      status:
        description: "Report test status"
        default: false
        type: boolean
        required: true

jobs:
  execute:
    name: Start tests
    runs-on: ubuntu-latest
    permissions:
      contents: none
    steps:
      - name: Trigger CircleCI 'local' workflow
        if: ${{ github.event.inputs.status == 'false' }}
        uses: promiseofcake/circleci-trigger-action@ad6655638ba0edda91939f3ac61a7f17981b1ed0 # v2.0.3
        with:
          user-token: ${{ secrets.CIRCLECI_TOKEN }}
          project-slug: slackapi/slack-cli
          branch: ${{ github.event.inputs.branch }}
          definition-id: ${{ secrets.CIRCLECI_DEFINITION_ID }}
          payload: '{"run_local_build_test_workflow": true}'
      - name: Trigger CircleCI 'e2e' workflow
        if: ${{ github.event.inputs.status == 'true' }}
        uses: promiseofcake/circleci-trigger-action@ad6655638ba0edda91939f3ac61a7f17981b1ed0 # v2.0.3
        with:
          user-token: ${{ secrets.CIRCLECI_TOKEN }}
          project-slug: slackapi/slack-cli
          branch: ${{ github.event.inputs.branch }}
          definition-id: ${{ secrets.CIRCLECI_DEFINITION_ID }}
          payload: '{"run_local_build_test_workflow": false}'
